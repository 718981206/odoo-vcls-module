<odoo>

<record id="landscape_paper_format_report" model="report.paperformat">
    <field name="name">A4 landscape report paper format</field>
    <field name="default" eval="False"/>
    <field name="format">custom</field>
    <field name="page_height">297</field>
    <field name="page_width">210</field>
    <field name="orientation">Landscape</field>
    <field name="margin_top">30</field>
    <field name="margin_bottom">23</field>
    <field name="margin_left">5</field>
    <field name="margin_right">5</field>
    <field name="header_line" eval="False"/>
    <field name="header_spacing">20</field>
    <field name="dpi">90</field>
</record>

<!-- Activity report simple version-->
<template id="report_invoice_activity_simple_document">
    <t t-call="web.external_layout">
        <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>
        <t t-set="data" t-value="o._get_activity_report_data(detailed=False)"/>
        <t t-set="project_rate_matrix_data" t-value="data['project_rate_matrix_data']"/>
        <t t-set="task_rate_matrix_data" t-value="data['task_rate_matrix_data']"/>
        <t t-set="rate_product_ids" t-value="data['rate_product_ids']"/>
        <t t-set="projects_row_data" t-value="data['projects_row_data']"/>
        <div class="page">
            <div class="oe_structure"/>
            <h5 class="text-center mt-3 mb-3">
                <span t-if="o.type == 'out_invoice' and o.state in ('open', 'in_payment', 'paid')">Activity report for invoice</span>
                <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Activity report for draft Invoice</span>
                <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Activity report for cancelled Invoice</span>
                <span t-if="o.type == 'out_refund'">Activity report for credit Note</span>
                <span t-if="o.type == 'in_refund'">Activity report for vendor Credit Note</span>
                <span t-if="o.type == 'in_invoice'">Activity report for vendor Bill</span>
                <span t-field="o.number"/>
            </h5>
            <table class="table table-sm o_main_table">
                <thead>
                    <th></th>
                    <th t-foreach="rate_product_ids" t-as="rate_product_id">
                        <t t-esc="rate_product_id.name"/>
                    </th>
                </thead>
                <tbody>
                    <t t-foreach="list(projects_row_data)" t-as="project_id">
                        <t t-set="tasks_row_data" t-value="projects_row_data[project_id]"/>
                        <tr style="font-weight: bold;">
                            <td><t t-esc="project_id.name"/></td>
                            <td t-foreach="rate_product_ids" t-as="rate_product_id" class="text-right">
                                <t t-esc="project_rate_matrix_data.get((project_id, rate_product_id), '-')"/>
                            </td>
                        </tr>
                        <t t-foreach="list(tasks_row_data)" t-as="task_id">
                            <t t-set="time_category_row_data" t-value="tasks_row_data[task_id]"/>
                            <tr>
                                <td class="pl-3"><t t-esc="task_id.name"/></td>
                                <td t-foreach="rate_product_ids" t-as="rate_product_id" class="text-right">
                                    <t t-esc="task_rate_matrix_data.get((project_id, task_id, rate_product_id), '-')"/>
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>
            </table>
            <div class="oe_structure"/>
        </div>
    </t>
</template>

<template id="report_invoice_activity_simple">
    <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="vcls-invoicing.report_invoice_activity_simple_document" t-lang="o.partner_id.lang"/>
        </t>
    </t>
</template>

<report id="invoice_activity_simple_report"
        model="account.invoice"
        string="Activity report (simple)"
        file="Activity report (simple)"
        report_type="qweb-pdf"
        name="vcls-invoicing.report_invoice_activity_simple"
/>
<record id="invoice_activity_simple_report" model="ir.actions.report">
    <field name="paperformat_id" ref="landscape_paper_format_report"/>
</record>



<!-- Activity report detailed version-->

<template id="report_invoice_activity_detailed_document" inherit_id="report_invoice_activity_simple_document" primary="True">
    <xpath expr="//t[@t-set='data']" position="attributes">
        <attribute name="t-value">o._get_activity_report_data(detailed=True)</attribute>
    </xpath>
    <xpath expr="//t[@t-set='data']" position="after">
        <t t-set="time_category_rate_matrix_data" t-value="data['time_category_rate_matrix_data']"/>
    </xpath>
    <xpath expr="//t[@t-as='task_id']" position="inside">
        <t t-foreach="list(time_category_row_data)" t-as="time_category_id">
            <tr>
                <td class="pl-5">
                    <t t-esc="time_category_id.name or 'No details'"/>
                </td>
                <td t-foreach="rate_product_ids" t-as="rate_product_id" class="text-right">
                    <t t-esc="time_category_rate_matrix_data.get((project_id, task_id, time_category_id, rate_product_id), '-')"/>
                </td>
            </tr>
        </t>
    </xpath>
</template>

<template id="report_invoice_activity_detailed">
    <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="vcls-invoicing.report_invoice_activity_detailed_document" t-lang="o.partner_id.lang"/>
        </t>
    </t>
</template>

<report id="invoice_activity_detailed_report"
        model="account.invoice"
        string="Activity report (detailed)"
        file="Activity report (detailed)"
        report_type="qweb-pdf"
        name="vcls-invoicing.report_invoice_activity_detailed"
/>
<record id="invoice_activity_detailed_report" model="ir.actions.report">
    <field name="paperformat_id" ref="landscape_paper_format_report"/>
</record>

</odoo>
